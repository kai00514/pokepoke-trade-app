# å¤šè¨€èªå¯¾å¿œ - å®Œå…¨è¨­è¨ˆ

**ä½œæˆæ—¥**: 2025-11-22
**å¯¾è±¡**: pokepoke-trade-app å…¨ä½“ã®å¤šè¨€èªåŒ–

---

## âœ… TODOãƒªã‚¹ãƒˆ

### Phase 1: UIãƒ†ã‚­ã‚¹ãƒˆï¼ˆâœ… è‹±èªã®ã¿å®Œäº† - 2025-11-28ï¼‰
- [x] i18nãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆï¼ˆ63ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- [x] next-intlè¨­å®š
- [x] ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰
- [x] **è¿½åŠ **: ä¸è¦ãªè¨€èªãƒ•ã‚©ãƒ«ãƒ€å‰Šé™¤ï¼ˆit, pt-brã‚’å‰Šé™¤ã€å®Ÿãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹7è¨€èªã®ã¿æ®‹ã™ï¼‰
- [x] **è¿½åŠ **: éŸ“å›½èªãƒ•ã‚©ãƒ«ãƒ€è¿½åŠ ï¼ˆkoï¼‰
- [x] **è‹±èªç¿»è¨³å®Œäº†**: locales/en/ ã®7ãƒ•ã‚¡ã‚¤ãƒ«å…¨ã¦ç¿»è¨³æ¸ˆã¿ï¼ˆcommon, auth, cards, errors, forms, messages, pagesï¼‰
- [ ] **ğŸ”´ æ‰‹å‹•ä½œæ¥­å¿…è¦**: ãã®ä»–6è¨€èªã®ç¿»è¨³ï¼ˆzh-cn, zh-tw, ko, fr, es, deï¼‰- DeepLç­‰ã‚’ä½¿ç”¨ã—ã¦æ‰‹å‹•ç¿»è¨³ã‚’æ¨å¥¨

### Phase 2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ï¼ˆå®Œäº†âœ… 2025-11-25ï¼‰
- [x] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³SQLä½œæˆï¼ˆ`scripts/phase2-i18n-migration-fixed.sql`ï¼‰
- [x] ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- [x] cards, packs ã« JSONB ã‚«ãƒ©ãƒ è¿½åŠ 
- [x] deck_pages, info_pages ã« 19 ã‚«ãƒ©ãƒ è¿½åŠ ï¼ˆ17â†’19ã«å¢—åŠ ï¼‰
- [x] info_article_blocks ã«ã‚«ãƒ©ãƒ è¿½åŠ ï¼ˆinfo_articlesã¯ãƒ†ã‚¹ãƒˆç’°å¢ƒã«å­˜åœ¨ã›ãšã‚¹ã‚­ãƒƒãƒ—ï¼‰
- [x] tournaments, é€šçŸ¥ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚«ãƒ©ãƒ è¿½åŠ 
- [x] decks, trade_posts, user_collages ã«ã‚«ãƒ©ãƒ è¿½åŠ 
- [x] translation_cache, translation_jobs ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [x] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆï¼ˆ26å€‹: 18 GIN + 8 è£œåŠ©ï¼‰
- [x] æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸå¤‰æ›ï¼ˆæ—¥æœ¬èªãƒ‡ãƒ¼ã‚¿â†’JSONBå½¢å¼ï¼‰
- [x] **è¿½åŠ **: col_3, col_4, col_5 ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°ï¼ˆ2,259ä»¶ï¼‰
- [x] **è¿½åŠ **: CSVã‹ã‚‰ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆï¼ˆ`scripts/import-multilingual-cards.js`ï¼‰
- [x] **è¿½åŠ **: 6è¨€èªã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œï¼ˆ2,248ä»¶: en, ko, zh-TW, fr, es, deï¼‰
- [x] **è¿½åŠ **: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã‚¬ã‚¤ãƒ‰ä½œæˆï¼ˆ`docs/phase2-migration-guide.md`ï¼‰
- [x] **è¿½åŠ **: ã‚«ãƒ¼ãƒ‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¬ã‚¤ãƒ‰ä½œæˆï¼ˆ`docs/cards-update-guide.md`ï¼‰
- [x] **è¿½åŠ **: ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯SQLä½œæˆï¼ˆ`scripts/phase2-i18n-rollback.sql`ï¼‰

### Phase 3: APIå®Ÿè£…ï¼ˆå®Œäº†âœ… 2025-11-25ï¼‰
- [x] `lib/i18n-helpers.ts` ä½œæˆï¼ˆJSONBæŠ½å‡ºãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼‰
- [x] ã‚«ãƒ¼ãƒ‰å–å¾—APIï¼ˆJSONBæ–¹å¼ï¼‰ - `/api/cards`, `/api/cards/[id]`
- [x] è¨˜äº‹å–å¾—APIï¼ˆJSONBæ–¹å¼ï¼‰ - `/api/info/[id]`
- [x] ãƒ‡ãƒƒã‚­ã‚¬ã‚¤ãƒ‰ãƒšãƒ¼ã‚¸å–å¾—APIï¼ˆJSONBæ–¹å¼ï¼‰ - `/api/deck-pages/[id]`
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒƒã‚­å–å¾—APIï¼ˆJSONBæ–¹å¼ï¼‰ - `/api/decks/[id]`
- [x] ãƒˆãƒ¬ãƒ¼ãƒ‰æŠ•ç¨¿å–å¾—APIï¼ˆJSONBæ–¹å¼ï¼‰ - `/api/trades`, `/api/trades/[id]`
- [x] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…ï¼ˆja â†’ en â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆçµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼‰
- [x] è¨€èªæ¤œå‡ºæ©Ÿèƒ½ï¼ˆlocale ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ»Accept-Language ãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰
- [x] **è¿½åŠ **: APIå®Ÿè£…ã‚¬ã‚¤ãƒ‰ä½œæˆï¼ˆ`docs/phase3-api-implementation.md`ï¼‰

### Phase 4: ç¿»è¨³ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆâš ï¸ ä¸€éƒ¨å®Œäº†ï¼‰
- [ ] **ğŸŸ¡ ç”³è«‹ä¸­**: Google Cloud Translate API ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆ`docs/Google-Cloud-Translate-APIå°å…¥ã‚¬ã‚¤ãƒ‰.md`å‚ç…§ï¼‰
  - [x] Google Cloudãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
  - [x] Translation APIæœ‰åŠ¹åŒ–ç”³è«‹ï¼ˆ**ç”³è«‹ä¸­ - 3å–¶æ¥­æ—¥ä»¥å†…ã«æ‰¿èªäºˆå®š**ï¼‰
  - [ ] ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒ»èªè¨¼æƒ…å ±å–å¾—ï¼ˆæ‰¿èªå¾Œï¼‰
  - [ ] ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆ.env.localï¼‰
  - [ ] Vercelç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆBase64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰
- [ ] `lib/google-translate.ts` ä½œæˆï¼ˆç¿»è¨³é–¢æ•°å®Ÿè£…ï¼‰- APIæ‰¿èªå¾Œã«å®Ÿè£…å¯èƒ½
- [x] **ã‚«ãƒ¼ãƒ‰åè¾æ›¸ä½œæˆï¼ˆ7è¨€èªå¯¾å¿œå®Œäº†: en, ko, zh-cn, zh-TW, fr, es, deï¼‰**
- [x] **CSVã‹ã‚‰ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ**ï¼ˆ`scripts/import-multilingual-cards.js`ï¼‰
- [x] **CSVãƒ‡ãƒ¼ã‚¿ã‚’JSONBãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›**ï¼ˆen, ko, zh-TW, fr, es, deï¼‰
- [x] **ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’DBã«ä¸€æ‹¬ã‚¤ãƒ³ãƒãƒ¼ãƒˆ**ï¼ˆ2,248ä»¶ï¼‰
- [x] **è¿½åŠ **: å¯¾å¿œè¨€èªã®æ•´ç†ï¼ˆit, pt-brã‚’é™¤å¤–ã€å®Ÿãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹7è¨€èªã«çµã‚‹ï¼‰
- [x] **è¿½åŠ **: Google Cloud Translate APIå°å…¥ã‚¬ã‚¤ãƒ‰ä½œæˆï¼ˆ`docs/Google-Cloud-Translate-APIå°å…¥ã‚¬ã‚¤ãƒ‰.md`ï¼‰
- [ ] ãƒ‘ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ç¿»è¨³ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆãƒ»å®Ÿè¡Œ
- [ ] ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç¿»è¨³ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆãƒ»å®Ÿè¡Œï¼ˆinfo_pages, deck_pagesç­‰ï¼‰
- [ ] ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ç¿»è¨³ãƒ¯ãƒ¼ã‚«ãƒ¼å®Ÿè£…
- [ ] translation_jobs å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- [ ] ç¿»è¨³ã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Ÿè£…
- [ ] ã‚³ãƒ¡ãƒ³ãƒˆç¿»è¨³æ™‚ã®ã‚«ãƒ¼ãƒ‰åç½®æ›æ©Ÿèƒ½å®Ÿè£…

### Phase 5: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆ2é€±é–“ï¼‰
- [ ] ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ›´æ–°
- [ ] è¨˜äº‹è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ›´æ–°
- [ ] ãƒ‡ãƒƒã‚­è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ›´æ–°
- [ ] ãƒˆãƒ¬ãƒ¼ãƒ‰æŠ•ç¨¿è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ›´æ–°
- [ ] ã‚³ãƒ¡ãƒ³ãƒˆç¿»è¨³ãƒœã‚¿ãƒ³å®Ÿè£…
- [ ] ç¿»è¨³APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…
- [ ] è¨€èªåˆ‡ã‚Šæ›¿ãˆå‹•ä½œç¢ºèª
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

### Phase 6: ãƒ†ã‚¹ãƒˆï¼†ãƒªãƒªãƒ¼ã‚¹ï¼ˆ1é€±é–“ï¼‰
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼‰
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆAPIï¼‰
- [ ] E2Eãƒ†ã‚¹ãƒˆï¼ˆè¨€èªåˆ‡ã‚Šæ›¿ãˆï¼‰
- [ ] å…¨è¨€èªã§è¡¨ç¤ºç¢ºèª
- [ ] ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºç¢ºèª
- [ ] æœ¬ç•ªDBãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- [ ] æœ¬ç•ªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- [ ] æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] æœ¬ç•ªå‹•ä½œç¢ºèª
- [ ] ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è¨­å®š

### Phase 7: é‹ç”¨ï¼†æœ€é©åŒ–
- [ ] ç¿»è¨³APIã‚³ã‚¹ãƒˆè¿½è·¡
- [ ] ç¿»è¨³ã‚¸ãƒ§ãƒ–ç›£è¦–
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†
- [ ] ç¿»è¨³å“è³ªæ”¹å–„

---

## ğŸ“‹ ç›®æ¬¡

1. [å¯¾å¿œç¯„å›²ã®åˆ†é¡](#å¯¾å¿œç¯„å›²ã®åˆ†é¡)
2. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ)
3. [å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º](#å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º)
4. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
5. [ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»](#ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»)

---

## å¯¾å¿œç¯„å›²ã®åˆ†é¡

### 1. UIãƒ†ã‚­ã‚¹ãƒˆï¼ˆnext-intlï¼‰âœ…

**å¯¾è±¡**: ãƒœã‚¿ãƒ³ã€ãƒ©ãƒ™ãƒ«ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãªã©

**æ–¹æ³•**: JSONãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
```
locales/
â”œâ”€â”€ ja/common.json
â”œâ”€â”€ en/common.json
â””â”€â”€ ...
```

**å®Ÿè£…**: Phase 2ã§å¯¾å¿œï¼ˆé‹ç”¨ã‚¬ã‚¤ãƒ‰å‚ç…§ï¼‰

---

### 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”Ÿæˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ ğŸ”„

**å¯¾è±¡**:
- ãƒ‡ãƒƒã‚­ã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜æ–‡
- ãƒˆãƒ¬ãƒ¼ãƒ‰æŠ•ç¨¿
- ã‚³ãƒ¡ãƒ³ãƒˆ

**ç‰¹å¾´**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªç”±ã«å…¥åŠ›
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç¿»è¨³ã¾ãŸã¯è¨€èªæ¤œå‡º
- æŠ•ç¨¿æ™‚ã®è¨€èªã‚’ä¿å­˜

#### 2-1. åŸºæœ¬æˆ¦ç•¥

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³A: æŠ•ç¨¿æ™‚è¨€èªã®ã¿ä¿å­˜ï¼ˆæ¨å¥¨ Phase 1ï¼‰**

æŠ•ç¨¿æ™‚ã®è¨€èªã§ä¿å­˜ã—ã€ä»–è¨€èªãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ç¿»è¨³æ©Ÿèƒ½ã‚’æä¾›

```typescript
// æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¨€èªã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
ALTER TABLE deck_posts ADD COLUMN language VARCHAR(10) DEFAULT 'ja';
ALTER TABLE trade_posts ADD COLUMN language VARCHAR(10) DEFAULT 'ja';
ALTER TABLE deck_comments ADD COLUMN language VARCHAR(10) DEFAULT 'ja';
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡ŒãŒå®¹æ˜“
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åŠ¹ç‡ãŒè‰¯ã„

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- ä»–è¨€èªãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç¿»è¨³æ©Ÿèƒ½ã«ä¾å­˜

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³B: å¤šè¨€èªãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆPhase 2ä»¥é™ï¼‰**

ä¸»è¦ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿ç¿»è¨³ç‰ˆã‚’ä¿å­˜

```sql
-- ãƒ‡ãƒƒã‚­æŠ•ç¨¿ã®ç¿»è¨³ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE deck_posts_i18n (
  id BIGSERIAL PRIMARY KEY,
  deck_post_id BIGINT REFERENCES deck_posts(id) ON DELETE CASCADE,
  language VARCHAR(10) NOT NULL,
  title TEXT NOT NULL,
  description TEXT,
  translated_by VARCHAR(20), -- 'user', 'ai', 'admin'
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(deck_post_id, language)
);

-- ãƒˆãƒ¬ãƒ¼ãƒ‰æŠ•ç¨¿ã®ç¿»è¨³ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE trade_posts_i18n (
  id BIGSERIAL PRIMARY KEY,
  trade_post_id BIGINT REFERENCES trade_posts(id) ON DELETE CASCADE,
  language VARCHAR(10) NOT NULL,
  title TEXT,
  description TEXT,
  translated_by VARCHAR(20),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(trade_post_id, language)
);
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- é«˜å“è³ªãªç¿»è¨³ã‚’äº‹å‰ä¿å­˜å¯èƒ½
- ç¿»è¨³APIã‚³ã‚¹ãƒˆå‰Šæ¸›
- SEOæœ€é©åŒ–

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å¢—åŠ 
- å®Ÿè£…ãŒè¤‡é›‘

---

### 3. ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆCMSçš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‰ğŸ“

**å¯¾è±¡**:
- è¨˜äº‹ãƒ»æœ€æ–°æƒ…å ±ï¼ˆinfo_pagesï¼‰
- ãƒ‡ãƒƒã‚­ã‚¬ã‚¤ãƒ‰ï¼ˆdeck_pagesï¼‰

**ç‰¹å¾´**:
- ç®¡ç†è€…ãŒä½œæˆ
- é«˜å“è³ªãªç¿»è¨³ãŒå¿…è¦
- å…¬å¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„

#### 3-1. ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ

**æ–¹æ³•1: æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã«ç¿»è¨³ã‚«ãƒ©ãƒ è¿½åŠ ï¼ˆç°¡æ˜“ç‰ˆï¼‰**

```sql
-- info_pagesã«ç¿»è¨³ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
ALTER TABLE info_pages ADD COLUMN title_en TEXT;
ALTER TABLE info_pages ADD COLUMN title_zh_cn TEXT;
ALTER TABLE info_pages ADD COLUMN content_en TEXT;
ALTER TABLE info_pages ADD COLUMN content_zh_cn TEXT;
```

**ãƒ¡ãƒªãƒƒãƒˆ**: ã‚·ãƒ³ãƒ—ãƒ«ã€ã‚¯ã‚¨ãƒªãŒç°¡å˜

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**: è¨€èªè¿½åŠ æ™‚ã«ã‚«ãƒ©ãƒ è¿½åŠ ãŒå¿…è¦

**æ–¹æ³•2: ç¿»è¨³ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆæ¨å¥¨ï¼‰**

```sql
-- è¨˜äº‹ã®ç¿»è¨³ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE info_pages_i18n (
  id BIGSERIAL PRIMARY KEY,
  info_page_id BIGINT REFERENCES info_pages(id) ON DELETE CASCADE,
  language VARCHAR(10) NOT NULL,
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  meta_description TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(info_page_id, language)
);

-- ãƒ‡ãƒƒã‚­ã‚¬ã‚¤ãƒ‰ã®ç¿»è¨³ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE deck_pages_i18n (
  id BIGSERIAL PRIMARY KEY,
  deck_page_id BIGINT REFERENCES deck_pages(id) ON DELETE CASCADE,
  language VARCHAR(10) NOT NULL,
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  meta_description TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(deck_page_id, language)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
CREATE INDEX idx_info_pages_i18n_page_lang ON info_pages_i18n(info_page_id, language);
CREATE INDEX idx_deck_pages_i18n_page_lang ON deck_pages_i18n(deck_page_id, language);
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ï¼ˆè¨€èªè¿½åŠ ãŒå®¹æ˜“ï¼‰
- è¨€èªã”ã¨ã«ç‹¬ç«‹ã—ãŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
- ç¿»è¨³çŠ¶æ³ã®ç®¡ç†ãŒå®¹æ˜“

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**: JOINãŒå¿…è¦

#### 3-2. ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// è¨˜äº‹ã‚’å–å¾—ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ãï¼‰
async function getInfoPage(id: number, locale: string) {
  const { data } = await supabase
    .from('info_pages')
    .select(`
      *,
      translations:info_pages_i18n!inner(
        title,
        content,
        meta_description
      )
    `)
    .eq('id', id)
    .eq('translations.language', locale)
    .single();

  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ç¿»è¨³ãŒãªã„å ´åˆã¯æ—¥æœ¬èªç‰ˆã‚’å–å¾—
  if (!data?.translations?.[0]) {
    const { data: fallbackData } = await supabase
      .from('info_pages')
      .select(`
        *,
        translations:info_pages_i18n!inner(
          title,
          content,
          meta_description
        )
      `)
      .eq('id', id)
      .eq('translations.language', 'ja')
      .single();

    return fallbackData;
  }

  return data;
}
```

---

### 4. ã‚«ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ ğŸ´

**å¯¾è±¡**:
- ã‚«ãƒ¼ãƒ‰å
- ã‚«ãƒ¼ãƒ‰èª¬æ˜æ–‡
- ãƒ‘ãƒƒã‚¯å
- ã‚¿ã‚¤ãƒ—å
- ãƒ¬ã‚¢ãƒªãƒ†ã‚£å

**ç‰¹å¾´**:
- å…¬å¼ãƒ‡ãƒ¼ã‚¿
- å›ºå®šãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†ä¸å¯ï¼‰
- é«˜é »åº¦ã‚¢ã‚¯ã‚»ã‚¹

#### 4-1. ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ

**æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª**:
```sql
-- ç¾åœ¨ã®cardsãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã‚’ç¢ºèª
SELECT column_name, data_type
FROM information_schema.columns
WHERE table_name = 'cards';
```

**æ¨å¥¨è¨­è¨ˆ: ç¿»è¨³ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ**

```sql
-- ã‚«ãƒ¼ãƒ‰ç¿»è¨³ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE cards_i18n (
  id BIGSERIAL PRIMARY KEY,
  card_id INTEGER REFERENCES cards(id) ON DELETE CASCADE,
  language VARCHAR(10) NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(card_id, language)
);

-- ãƒ‘ãƒƒã‚¯åç¿»è¨³ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE packs_i18n (
  id BIGSERIAL PRIMARY KEY,
  pack_id INTEGER REFERENCES packs(id) ON DELETE CASCADE,
  language VARCHAR(10) NOT NULL,
  name TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(pack_id, language)
);

-- ã‚¿ã‚¤ãƒ—ç¿»è¨³ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE types_i18n (
  id BIGSERIAL PRIMARY KEY,
  type_code VARCHAR(50) NOT NULL,
  language VARCHAR(10) NOT NULL,
  name TEXT NOT NULL,
  UNIQUE(type_code, language)
);

-- ãƒ¬ã‚¢ãƒªãƒ†ã‚£ç¿»è¨³ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE rarities_i18n (
  id BIGSERIAL PRIMARY KEY,
  rarity_code VARCHAR(50) NOT NULL,
  language VARCHAR(10) NOT NULL,
  name TEXT NOT NULL,
  UNIQUE(rarity_code, language)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰
CREATE INDEX idx_cards_i18n_card_lang ON cards_i18n(card_id, language);
CREATE INDEX idx_packs_i18n_pack_lang ON packs_i18n(pack_id, language);
CREATE INDEX idx_types_i18n_code_lang ON types_i18n(type_code, language);
CREATE INDEX idx_rarities_i18n_code_lang ON rarities_i18n(rarity_code, language);
```

#### 4-2. ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ä¾‹

```sql
-- æ—¢å­˜ã®æ—¥æœ¬èªãƒ‡ãƒ¼ã‚¿ã‚’ç¿»è¨³ãƒ†ãƒ¼ãƒ–ãƒ«ã«ç§»è¡Œ
INSERT INTO cards_i18n (card_id, language, name, description)
SELECT id, 'ja', name, description
FROM cards;

-- è‹±èªãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ï¼ˆä¾‹ï¼‰
INSERT INTO cards_i18n (card_id, language, name, description) VALUES
  (1, 'en', 'Pikachu', 'When this PokÃ©mon becomes your Active PokÃ©mon...'),
  (2, 'en', 'Charizard', 'Discard 2 Energy from this PokÃ©mon...');

-- ãƒ‘ãƒƒã‚¯åã®ç¿»è¨³
INSERT INTO packs_i18n (pack_id, language, name) VALUES
  (1, 'en', 'Genetic Apex'),
  (1, 'ja', 'éºä¼å­ã®é ‚ç‚¹');
```

#### 4-3. ãƒ“ãƒ¥ãƒ¼ä½œæˆï¼ˆã‚¯ã‚¨ãƒªç°¡ç•¥åŒ–ï¼‰

```sql
-- å¤šè¨€èªå¯¾å¿œã‚«ãƒ¼ãƒ‰ãƒ“ãƒ¥ãƒ¼
CREATE VIEW cards_with_i18n AS
SELECT
  c.*,
  ci.language,
  ci.name as localized_name,
  ci.description as localized_description
FROM cards c
LEFT JOIN cards_i18n ci ON c.id = ci.card_id;

-- ä½¿ç”¨ä¾‹
SELECT * FROM cards_with_i18n WHERE language = 'en';
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ

**âš ï¸ é‡è¦**: æœ€æ–°ã®è¨­è¨ˆã§ã¯**JSONBæ–¹å¼**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ï¼ˆ`docs/å¤šè¨€èªã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã‚µãƒãƒªãƒ¼.md`å‚ç…§ï¼‰

### å®Œå…¨ãªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³SQL

```sql
-- ===================================
-- Phase 1: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆcards, packsï¼‰
-- ===================================

-- 1. cards: ã‚«ãƒ¼ãƒ‰åã¨ç”»åƒURL
ALTER TABLE cards ADD COLUMN IF NOT EXISTS name_multilingual JSONB NOT NULL DEFAULT '{"ja":""}'::jsonb;
ALTER TABLE cards ADD COLUMN IF NOT EXISTS image_url_multilingual JSONB NOT NULL DEFAULT '{}'::jsonb;

-- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿å¤‰æ›
UPDATE cards SET
    name_multilingual = jsonb_build_object('ja', name),
    image_url_multilingual = jsonb_build_object('ja', image_url, 'en', image_url, 'zh-CN', image_url, 'zh-TW', image_url, 'ko', image_url)
WHERE name_multilingual = '{"ja":""}'::jsonb;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX IF NOT EXISTS idx_cards_name_multilingual ON cards USING GIN(name_multilingual);
CREATE INDEX IF NOT EXISTS idx_cards_image_url_multilingual ON cards USING GIN(image_url_multilingual);

-- 2. packs: ãƒ‘ãƒƒã‚¯å
ALTER TABLE packs ADD COLUMN IF NOT EXISTS name_multilingual JSONB NOT NULL DEFAULT '{"ja":""}'::jsonb;

-- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿å¤‰æ›
UPDATE packs SET name_multilingual = jsonb_build_object('ja', name)
WHERE name_multilingual = '{"ja":""}'::jsonb;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX IF NOT EXISTS idx_packs_name_multilingual ON packs USING GIN(name_multilingual);

-- ===================================
-- Phase 2: ç®¡ç†è€…ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆ17ã‚«ãƒ©ãƒ Ã—2ãƒ†ãƒ¼ãƒ–ãƒ« + è¨˜äº‹ï¼‰
-- ===================================

-- 3. deck_pages: ãƒ‡ãƒƒã‚­ã‚¬ã‚¤ãƒ‰ï¼ˆ17ã‚«ãƒ©ãƒ ï¼‰
ALTER TABLE deck_pages
ADD COLUMN IF NOT EXISTS title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS thumbnail_image_url_multilingual JSONB,
ADD COLUMN IF NOT EXISTS thumbnail_alt_multilingual JSONB,
ADD COLUMN IF NOT EXISTS deck_badge_multilingual JSONB,
ADD COLUMN IF NOT EXISTS section1_title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS deck_name_multilingual JSONB,
ADD COLUMN IF NOT EXISTS energy_image_url_multilingual JSONB,
ADD COLUMN IF NOT EXISTS deck_cards_multilingual JSONB,
ADD COLUMN IF NOT EXISTS deck_description_multilingual JSONB,
ADD COLUMN IF NOT EXISTS evaluation_title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS tier_rank_multilingual JSONB,
ADD COLUMN IF NOT EXISTS tier_name_multilingual JSONB,
ADD COLUMN IF NOT EXISTS tier_descriptions_multilingual JSONB,
ADD COLUMN IF NOT EXISTS section2_title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS strengths_weaknesses_details_multilingual JSONB,
ADD COLUMN IF NOT EXISTS section3_title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS how_to_play_steps_multilingual JSONB;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX IF NOT EXISTS idx_deck_pages_title_multilingual ON deck_pages USING GIN(title_multilingual);
CREATE INDEX IF NOT EXISTS idx_deck_pages_deck_cards_multilingual ON deck_pages USING GIN(deck_cards_multilingual);
CREATE INDEX IF NOT EXISTS idx_deck_pages_strengths_multilingual ON deck_pages USING GIN(strengths_weaknesses_details_multilingual);
CREATE INDEX IF NOT EXISTS idx_deck_pages_howto_multilingual ON deck_pages USING GIN(how_to_play_steps_multilingual);

-- 4. info_pages: è¨˜äº‹ãƒšãƒ¼ã‚¸ï¼ˆdeck_pagesã¨åŒã˜17ã‚«ãƒ©ãƒ ï¼‰
ALTER TABLE info_pages
ADD COLUMN IF NOT EXISTS title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS thumbnail_image_url_multilingual JSONB,
ADD COLUMN IF NOT EXISTS thumbnail_alt_multilingual JSONB,
ADD COLUMN IF NOT EXISTS deck_badge_multilingual JSONB,
ADD COLUMN IF NOT EXISTS section1_title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS deck_name_multilingual JSONB,
ADD COLUMN IF NOT EXISTS energy_image_url_multilingual JSONB,
ADD COLUMN IF NOT EXISTS deck_cards_multilingual JSONB,
ADD COLUMN IF NOT EXISTS deck_description_multilingual JSONB,
ADD COLUMN IF NOT EXISTS evaluation_title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS tier_rank_multilingual JSONB,
ADD COLUMN IF NOT EXISTS tier_name_multilingual JSONB,
ADD COLUMN IF NOT EXISTS tier_descriptions_multilingual JSONB,
ADD COLUMN IF NOT EXISTS section2_title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS strengths_weaknesses_details_multilingual JSONB,
ADD COLUMN IF NOT EXISTS section3_title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS how_to_play_steps_multilingual JSONB;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX IF NOT EXISTS idx_info_pages_title_multilingual ON info_pages USING GIN(title_multilingual);

-- 5. info_articles: è¨˜äº‹ï¼ˆ7ã‚«ãƒ©ãƒ ï¼‰
ALTER TABLE info_articles
ADD COLUMN IF NOT EXISTS slug_multilingual JSONB,
ADD COLUMN IF NOT EXISTS title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS subtitle_multilingual JSONB,
ADD COLUMN IF NOT EXISTS excerpt_multilingual JSONB,
ADD COLUMN IF NOT EXISTS thumbnail_image_url_multilingual JSONB,
ADD COLUMN IF NOT EXISTS hero_image_url_multilingual JSONB,
ADD COLUMN IF NOT EXISTS tags_multilingual JSONB;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX IF NOT EXISTS idx_info_articles_title_multilingual ON info_articles USING GIN(title_multilingual);
CREATE INDEX IF NOT EXISTS idx_info_articles_slug_multilingual ON info_articles USING GIN(slug_multilingual);
CREATE INDEX IF NOT EXISTS idx_info_articles_tags_multilingual ON info_articles USING GIN(tags_multilingual);

-- 6. info_article_blocks: è¨˜äº‹ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆ1ã‚«ãƒ©ãƒ ï¼‰
ALTER TABLE info_article_blocks
ADD COLUMN IF NOT EXISTS data_multilingual JSONB;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX IF NOT EXISTS idx_info_article_blocks_data_multilingual ON info_article_blocks USING GIN(data_multilingual);

-- 7. tournaments: å¤§ä¼šæƒ…å ±ï¼ˆ2ã‚«ãƒ©ãƒ ï¼‰
ALTER TABLE tournaments
ADD COLUMN IF NOT EXISTS title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS benefit_multilingual JSONB;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX IF NOT EXISTS idx_tournaments_title_multilingual ON tournaments USING GIN(title_multilingual);

-- ===================================
-- Phase 3: é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
-- ===================================

-- 8. deck_notifications
ALTER TABLE deck_notifications
ADD COLUMN IF NOT EXISTS content_multilingual JSONB;

CREATE INDEX IF NOT EXISTS idx_deck_notifications_content_multilingual ON deck_notifications USING GIN(content_multilingual);

-- 9. trade_notifications
ALTER TABLE trade_notifications
ADD COLUMN IF NOT EXISTS content_multilingual JSONB;

CREATE INDEX IF NOT EXISTS idx_trade_notifications_content_multilingual ON trade_notifications USING GIN(content_multilingual);

-- ===================================
-- Phase 4: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
-- ===================================

-- 10. decksï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆãƒ‡ãƒƒã‚­ï¼‰
ALTER TABLE decks
ADD COLUMN IF NOT EXISTS title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS description_multilingual JSONB,
ADD COLUMN IF NOT EXISTS translation_status TEXT DEFAULT 'pending',
ADD COLUMN IF NOT EXISTS auto_translated_at TIMESTAMPTZ;

ALTER TABLE decks
ADD CONSTRAINT check_translation_status
CHECK (translation_status IN ('pending', 'processing', 'completed', 'failed'));

CREATE INDEX IF NOT EXISTS idx_decks_title_multilingual ON decks USING GIN(title_multilingual);
CREATE INDEX IF NOT EXISTS idx_decks_translation_status ON decks(translation_status);

-- 11. trade_postsï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‰æŠ•ç¨¿ï¼‰
ALTER TABLE trade_posts
ADD COLUMN IF NOT EXISTS title_multilingual JSONB,
ADD COLUMN IF NOT EXISTS comment_multilingual JSONB,
ADD COLUMN IF NOT EXISTS wanted_card_id_multilingual JSONB,
ADD COLUMN IF NOT EXISTS offered_card_id_multilingual JSONB,
ADD COLUMN IF NOT EXISTS translation_status TEXT DEFAULT 'pending';

ALTER TABLE trade_posts
ADD CONSTRAINT check_trade_translation_status
CHECK (translation_status IN ('pending', 'processing', 'completed', 'failed'));

CREATE INDEX IF NOT EXISTS idx_trade_posts_title_multilingual ON trade_posts USING GIN(title_multilingual);
CREATE INDEX IF NOT EXISTS idx_trade_posts_translation_status ON trade_posts(translation_status);

-- 12. trade_owned_listï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆï¼‰
ALTER TABLE trade_owned_list
ADD COLUMN IF NOT EXISTS list_name_multilingual JSONB,
ADD COLUMN IF NOT EXISTS translation_status TEXT DEFAULT 'pending';

CREATE INDEX IF NOT EXISTS idx_trade_owned_list_translation_status ON trade_owned_list(translation_status);

-- 13. user_collagesï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ©ãƒ¼ã‚¸ãƒ¥ï¼‰
ALTER TABLE user_collages
ADD COLUMN IF NOT EXISTS title1_multilingual JSONB,
ADD COLUMN IF NOT EXISTS title2_multilingual JSONB,
ADD COLUMN IF NOT EXISTS translation_status TEXT DEFAULT 'pending';

CREATE INDEX IF NOT EXISTS idx_user_collages_translation_status ON user_collages(translation_status);

-- ===================================
-- Phase 5: æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«
-- ===================================

-- translation_cache: ç¿»è¨³ã‚­ãƒ£ãƒƒã‚·ãƒ¥
CREATE TABLE IF NOT EXISTS translation_cache (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    source_text TEXT NOT NULL,
    source_language TEXT NOT NULL,
    target_language TEXT NOT NULL,
    translated_text TEXT NOT NULL,
    service_used TEXT NOT NULL,
    char_count INTEGER NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    last_accessed_at TIMESTAMPTZ DEFAULT NOW(),
    access_count INTEGER DEFAULT 1,
    UNIQUE(source_text, source_language, target_language)
);

CREATE INDEX IF NOT EXISTS idx_translation_cache_lookup ON translation_cache(source_text, source_language, target_language);

-- translation_jobs: ç¿»è¨³ã‚¸ãƒ§ãƒ–ç®¡ç†
CREATE TABLE IF NOT EXISTS translation_jobs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    entity_type TEXT NOT NULL,
    entity_id TEXT NOT NULL,
    source_language TEXT NOT NULL,
    target_languages TEXT[] NOT NULL,
    status TEXT NOT NULL DEFAULT 'pending',
    priority INTEGER DEFAULT 0,
    service TEXT,
    error_message TEXT,
    retry_count INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    started_at TIMESTAMPTZ,
    completed_at TIMESTAMPTZ,
    UNIQUE(entity_type, entity_id, status)
);

CREATE INDEX IF NOT EXISTS idx_translation_jobs_status ON translation_jobs(status, priority DESC, created_at);
CREATE INDEX IF NOT EXISTS idx_translation_jobs_entity ON translation_jobs(entity_type, entity_id);
```

### JSONBæ§‹é€ ä¾‹

#### cards.name_multilingual
```json
{
  "ja": "ãƒ”ã‚«ãƒãƒ¥ã‚¦ex",
  "en": "Pikachu ex",
  "zh-CN": "çš®å¡ä¸˜ex",
  "zh-TW": "çš®å¡ä¸˜ex",
  "ko": "í”¼ì¹´ì¸„ex"
}
```

#### deck_pages.deck_cards_multilingual
```json
{
  "ja": [
    {"card_id": 4762, "pack_name": "æœªçŸ¥ãªã‚‹æ°´åŸŸ", "card_count": 2, "display_order": 0}
  ],
  "en": [
    {"card_id": 4762, "pack_name": "Unknown Depths", "card_count": 2, "display_order": 0}
  ]
}
```

#### trade_posts.wanted_card_id_multilingual
```json
{
  "ja": [
    {"id": 123, "name": "ãƒ”ã‚«ãƒãƒ¥ã‚¦ex", "imageUrl": "..."}
  ],
  "en": [
    {"id": 123, "name": "Pikachu ex", "imageUrl": "..."}
  ]
}
```

---

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: åŸºç›¤æ§‹ç¯‰ï¼ˆ1é€±é–“ï¼‰âœ… å®Œäº†

- [x] UIãƒ†ã‚­ã‚¹ãƒˆã®i18nãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
- [x] next-intlè¨­å®š
- [x] ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰

### Phase 2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ï¼ˆ1é€±é–“ï¼‰

#### 2-1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æº–å‚™

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
supabase migration new add_i18n_tables
```

#### 2-2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒï¼‰

```bash
# ãƒ†ã‚¹ãƒˆç’°å¢ƒã§å®Ÿè¡Œ
psql "postgresql://postgres:iZVIKuRfhhGmplxwjduVeUWLEiTisaui@db.oflucnwezzqqtxryonhf.supabase.co:5432/postgres" < migrations/add_i18n_tables.sql

# ç¢ºèª
psql "postgresql://..." -c "\dt *i18n*"
```

#### 2-3. ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ

```typescript
// scripts/migrate-i18n-data.ts
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  process.env.SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!
);

async function migrateCardsData() {
  // æ—¢å­˜ã®æ—¥æœ¬èªã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  const { data: cards } = await supabase
    .from('cards')
    .select('id, name, description');

  // cards_i18nã«æŠ•å…¥
  const i18nData = cards?.map(card => ({
    card_id: card.id,
    language: 'ja',
    name: card.name,
    description: card.description
  }));

  const { error } = await supabase
    .from('cards_i18n')
    .insert(i18nData);

  if (error) {
    console.error('Migration error:', error);
  } else {
    console.log(`Migrated ${i18nData?.length} cards`);
  }
}

migrateCardsData();
```

### Phase 3: APIå®Ÿè£…ï¼ˆ2é€±é–“ï¼‰

#### 3-1. ã‚«ãƒ¼ãƒ‰å–å¾—APIï¼ˆJSONBæ–¹å¼ï¼‰

```typescript
// app/api/cards/route.ts
import { createClient } from '@/lib/supabase/server';
import { NextRequest } from 'next/server';

export async function GET(request: NextRequest) {
  const locale = request.headers.get('Accept-Language') || 'ja';
  const supabase = await createClient();

  const { data: cards } = await supabase
    .from('cards')
    .select('id, name_multilingual, image_url_multilingual, type_code, rarity_code');

  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§è¨€èªã‚’å–ã‚Šå‡ºã™
  const localizedCards = cards?.map(card => ({
    id: card.id,
    name: card.name_multilingual[locale] || card.name_multilingual['ja'],
    image_url: card.image_url_multilingual[locale] || card.image_url_multilingual['ja'],
    type_code: card.type_code,
    rarity_code: card.rarity_code
  }));

  return Response.json({ cards: localizedCards });
}
```

#### 3-2. è¨˜äº‹å–å¾—APIï¼ˆJSONBæ–¹å¼ï¼‰

```typescript
// app/api/info/[id]/route.ts
import { createClient } from '@/lib/supabase/server';
import { NextRequest } from 'next/server';

export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const locale = request.headers.get('Accept-Language') || 'ja';
  const supabase = await createClient();

  const { data } = await supabase
    .from('info_pages')
    .select('*')
    .eq('id', params.id)
    .single();

  if (!data) {
    return Response.json({ error: 'Not found' }, { status: 404 });
  }

  // JSONBã‹ã‚‰è¨€èªã‚’æŠ½å‡ºï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ãï¼‰
  const localizedData = {
    ...data,
    title: data.title_multilingual?.[locale] || data.title_multilingual?.['ja'] || data.title,
    deck_name: data.deck_name_multilingual?.[locale] || data.deck_name_multilingual?.['ja'] || data.deck_name,
    deck_description: data.deck_description_multilingual?.[locale] || data.deck_description_multilingual?.['ja'] || data.deck_description,
    // ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚åŒæ§˜
  };

  return Response.json({ data: localizedData });
}
```

#### 3-3. JSONBæŠ½å‡ºãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°

```typescript
// lib/i18n-helpers.ts

/**
 * JSONBãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰è¨€èªã‚’æŠ½å‡ºï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ãï¼‰
 */
export function getLocalizedText(
  multilingual: Record<string, string> | null | undefined,
  locale: string,
  fallback: string = ''
): string {
  if (!multilingual) return fallback;
  return multilingual[locale] || multilingual['ja'] || fallback;
}

/**
 * JSONBé…åˆ—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰è¨€èªã‚’æŠ½å‡º
 */
export function getLocalizedArray<T>(
  multilingual: Record<string, T[]> | null | undefined,
  locale: string
): T[] {
  if (!multilingual) return [];
  return multilingual[locale] || multilingual['ja'] || [];
}

/**
 * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’å¤šè¨€èªåŒ–
 */
export function localizeObject<T extends Record<string, any>>(
  obj: T,
  locale: string,
  fields: (keyof T)[]
): T {
  const result = { ...obj };

  fields.forEach(field => {
    const multilingualField = `${String(field)}_multilingual` as keyof T;
    if (multilingualField in obj) {
      result[field] = getLocalizedText(
        obj[multilingualField] as any,
        locale,
        obj[field] as string
      );
    }
  });

  return result;
}

// ä½¿ç”¨ä¾‹
const localizedCard = localizeObject(
  card,
  'en',
  ['name', 'description']
);
```

### Phase 4: ç¿»è¨³ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆ3é€±é–“ï¼‰

#### 4-0. Google Cloud Translate è¨­å®š

**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**

```bash
pnpm add @google-cloud/translate
```

**ç’°å¢ƒå¤‰æ•°è¨­å®š**

```bash
# .env.local
GOOGLE_CLOUD_PROJECT_ID=your-project-id
GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json

# ã¾ãŸã¯ Vercelç’°å¢ƒå¤‰æ•°
# GOOGLE_CLOUD_API_KEY=your-api-key
```

**ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼å–å¾—**

1. Google Cloud Console > IAM & Admin > Service Accounts
2. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã¾ãŸã¯é¸æŠ
3. ã‚­ãƒ¼ã‚’ä½œæˆ > JSON > ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
4. Vercelã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆBase64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰

#### 4-1. ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®ç¿»è¨³ï¼ˆJSONBæ–¹å¼ï¼‰

**ç¿»è¨³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**

```typescript
// scripts/translate-cards.ts
import { createClient } from '@supabase/supabase-js';
import { translateText } from '@/lib/translation'; // Google Cloud Translate

const supabase = createClient(
  process.env.SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!
);

const TARGET_LANGUAGES = ['en', 'zh-CN', 'zh-TW', 'ko'];

async function translateCards() {
  // å…¨ã‚«ãƒ¼ãƒ‰ã‚’å–å¾—
  const { data: cards } = await supabase
    .from('cards')
    .select('id, name, name_multilingual');

  for (const card of cards || []) {
    console.log(`Translating card ${card.id}: ${card.name}`);

    // æ—¢å­˜ã®å¤šè¨€èªãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    const multilingual = card.name_multilingual || { ja: card.name };

    // å„è¨€èªã«ç¿»è¨³
    for (const targetLang of TARGET_LANGUAGES) {
      // ã™ã§ã«ç¿»è¨³æ¸ˆã¿ãªã‚‰ã‚¹ã‚­ãƒƒãƒ—
      if (multilingual[targetLang]) {
        console.log(`  ${targetLang}: already translated`);
        continue;
      }

      // Google Cloud Translateã§ç¿»è¨³
      const translated = await translateText(
        multilingual.ja,
        'ja',
        targetLang
      );

      multilingual[targetLang] = translated;
      console.log(`  ${targetLang}: ${translated}`);

      // é€²æ—ã‚’1ä»¶ãšã¤ä¿å­˜ï¼ˆå¤§é‡ãƒ‡ãƒ¼ã‚¿ã®å ´åˆï¼‰
      await supabase
        .from('cards')
        .update({ name_multilingual: multilingual })
        .eq('id', card.id);

      // ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾ç­–
      await sleep(100);
    }
  }

  console.log('Translation completed!');
}

function sleep(ms: number) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

translateCards();
```

#### 4-2. ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç¿»è¨³ï¼ˆJSONBæ–¹å¼ï¼‰

```typescript
// scripts/translate-info-pages.ts
async function translateInfoPages() {
  const { data: pages } = await supabase
    .from('info_pages')
    .select('*');

  for (const page of pages || []) {
    console.log(`Translating page ${page.id}`);

    // å„å¤šè¨€èªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç¿»è¨³
    const updates: any = {};

    // title_multilingual
    if (page.title) {
      updates.title_multilingual = { ja: page.title };
      for (const lang of TARGET_LANGUAGES) {
        updates.title_multilingual[lang] = await translateText(
          page.title,
          'ja',
          lang
        );
      }
    }

    // deck_description_multilingual
    if (page.deck_description) {
      updates.deck_description_multilingual = { ja: page.deck_description };
      for (const lang of TARGET_LANGUAGES) {
        updates.deck_description_multilingual[lang] = await translateText(
          page.deck_description,
          'ja',
          lang
        );
      }
    }

    // JSONBé…åˆ—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç¿»è¨³
    if (page.deck_cards) {
      updates.deck_cards_multilingual = { ja: page.deck_cards };

      for (const lang of TARGET_LANGUAGES) {
        const translatedCards = [];

        for (const card of page.deck_cards) {
          translatedCards.push({
            ...card,
            pack_name: await translateText(card.pack_name, 'ja', lang)
          });
        }

        updates.deck_cards_multilingual[lang] = translatedCards;
      }
    }

    // æ›´æ–°
    await supabase
      .from('info_pages')
      .update(updates)
      .eq('id', page.id);
  }
}
```

#### 4-3. ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ç¿»è¨³ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‰

```typescript
// lib/translation-worker.ts
import { createClient } from '@supabase/supabase-js';
import { translateText } from '@/lib/translation';

const supabase = createClient(
  process.env.SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!
);

/**
 * ç¿»è¨³ã‚¸ãƒ§ãƒ–ã‚’å‡¦ç†ã™ã‚‹ãƒ¯ãƒ¼ã‚«ãƒ¼
 */
export async function processTranslationJobs() {
  // pendingçŠ¶æ…‹ã®ã‚¸ãƒ§ãƒ–ã‚’å–å¾—
  const { data: jobs } = await supabase
    .from('translation_jobs')
    .select('*')
    .eq('status', 'pending')
    .order('priority', { ascending: false })
    .order('created_at', { ascending: true })
    .limit(10);

  for (const job of jobs || []) {
    try {
      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
      await supabase
        .from('translation_jobs')
        .update({ status: 'processing', started_at: new Date().toISOString() })
        .eq('id', job.id);

      // ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å–å¾—
      const { data: entity } = await supabase
        .from(job.entity_type)
        .select('*')
        .eq('id', job.entity_id)
        .single();

      if (!entity) {
        throw new Error(`Entity not found: ${job.entity_type}:${job.entity_id}`);
      }

      // ç¿»è¨³ã‚’å®Ÿè¡Œ
      const updates: any = {};

      // decksã®å ´åˆ
      if (job.entity_type === 'decks') {
        if (entity.title) {
          updates.title_multilingual = { ja: entity.title };
          for (const lang of job.target_languages) {
            updates.title_multilingual[lang] = await translateText(
              entity.title,
              job.source_language,
              lang
            );
          }
        }

        if (entity.description) {
          updates.description_multilingual = { ja: entity.description };
          for (const lang of job.target_languages) {
            updates.description_multilingual[lang] = await translateText(
              entity.description,
              job.source_language,
              lang
            );
          }
        }

        updates.translation_status = 'completed';
        updates.auto_translated_at = new Date().toISOString();
      }

      // ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æ›´æ–°
      await supabase
        .from(job.entity_type)
        .update(updates)
        .eq('id', job.entity_id);

      // ã‚¸ãƒ§ãƒ–ã‚’å®Œäº†
      await supabase
        .from('translation_jobs')
        .update({ status: 'completed', completed_at: new Date().toISOString() })
        .eq('id', job.id);

      console.log(`Completed translation job ${job.id}`);
    } catch (error) {
      console.error(`Failed job ${job.id}:`, error);

      // ã‚¨ãƒ©ãƒ¼è¨˜éŒ²
      await supabase
        .from('translation_jobs')
        .update({
          status: 'failed',
          error_message: error.message,
          retry_count: job.retry_count + 1
        })
        .eq('id', job.id);
    }
  }
}

// å®šæœŸå®Ÿè¡Œï¼ˆä¾‹: æ¯åˆ†ï¼‰
setInterval(processTranslationJobs, 60000);
```

### Phase 5: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆ2é€±é–“ï¼‰

#### 5-1. ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆJSONBæ–¹å¼ï¼‰

```typescript
// components/card-display.tsx
'use client';
import { useLocale } from 'next-intl';
import { useEffect, useState } from 'react';
import { getLocalizedText } from '@/lib/i18n-helpers';

interface Card {
  id: number;
  name_multilingual: Record<string, string>;
  image_url_multilingual: Record<string, string>;
}

export default function CardDisplay({ cardId }: { cardId: number }) {
  const locale = useLocale();
  const [card, setCard] = useState<Card | null>(null);

  useEffect(() => {
    fetch(`/api/cards/${cardId}`)
      .then(res => res.json())
      .then(data => setCard(data));
  }, [cardId]);

  if (!card) return <div>Loading...</div>;

  // JSONB ã‹ã‚‰è¨€èªã‚’æŠ½å‡º
  const name = getLocalizedText(card.name_multilingual, locale);
  const imageUrl = getLocalizedText(card.image_url_multilingual, locale);

  return (
    <div>
      <h3>{name}</h3>
      <img src={imageUrl} alt={name} />
    </div>
  );
}
```

#### 5-2. è¨˜äº‹è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆJSONBæ–¹å¼ï¼‰

```typescript
// app/info/[id]/page.tsx
import { createClient } from '@/lib/supabase/server';
import { getLocalizedText, getLocalizedArray } from '@/lib/i18n-helpers';

export default async function InfoPage({
  params
}: {
  params: { id: string }
}) {
  const supabase = await createClient();
  const locale = 'ja'; // ã¾ãŸã¯å‹•çš„ã«å–å¾—

  const { data: page } = await supabase
    .from('info_pages')
    .select('*')
    .eq('id', params.id)
    .single();

  if (!page) {
    return <div>Page not found</div>;
  }

  // å¤šè¨€èªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰è¨€èªã‚’æŠ½å‡º
  const title = getLocalizedText(page.title_multilingual, locale);
  const deckName = getLocalizedText(page.deck_name_multilingual, locale);
  const deckDescription = getLocalizedText(page.deck_description_multilingual, locale);
  const deckCards = getLocalizedArray(page.deck_cards_multilingual, locale);

  return (
    <div>
      <h1>{title}</h1>
      <h2>{deckName}</h2>
      <p>{deckDescription}</p>

      <div className="deck-cards">
        {deckCards.map((card: any, index: number) => (
          <div key={index}>
            <span>{card.pack_name}</span>
            <span>Ã—{card.card_count}</span>
          </div>
        ))}
      </div>
    </div>
  );
}
```

#### 5-3. ã‚³ãƒ¡ãƒ³ãƒˆç¿»è¨³ãƒœã‚¿ãƒ³ï¼ˆéƒ½åº¦ç¿»è¨³ï¼‰

```typescript
// components/comment-with-translation.tsx
'use client';
import { useState } from 'react';
import { useLocale } from 'next-intl';

interface Comment {
  id: string;
  content: string;
  user_id: string;
  created_at: string;
}

export default function CommentWithTranslation({ comment }: { comment: Comment }) {
  const locale = useLocale();
  const [translatedContent, setTranslatedContent] = useState<string | null>(null);
  const [isTranslating, setIsTranslating] = useState(false);

  const handleTranslate = async () => {
    setIsTranslating(true);

    try {
      const response = await fetch('/api/translate-comment', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          text: comment.content,
          targetLanguage: locale
        })
      });

      const data = await response.json();
      setTranslatedContent(data.translatedText);
    } catch (error) {
      console.error('Translation failed:', error);
    } finally {
      setIsTranslating(false);
    }
  };

  return (
    <div className="comment">
      <p>{translatedContent || comment.content}</p>

      {!translatedContent && locale !== 'ja' && (
        <button
          onClick={handleTranslate}
          disabled={isTranslating}
          className="text-sm text-blue-600 hover:underline"
        >
          {isTranslating ? 'ç¿»è¨³ä¸­...' : 'ç¿»è¨³ã™ã‚‹'}
        </button>
      )}

      {translatedContent && (
        <button
          onClick={() => setTranslatedContent(null)}
          className="text-sm text-gray-600 hover:underline"
        >
          å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º
        </button>
      )}
    </div>
  );
}
```

#### 5-4. ç¿»è¨³APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆã‚«ãƒ¼ãƒ‰åç½®æ›æ©Ÿèƒ½ä»˜ãï¼‰

```typescript
// app/api/translate-comment/route.ts
import { createClient } from '@/lib/supabase/server';
import { translateText, replaceCardNames } from '@/lib/translation';
import { NextRequest } from 'next/server';

export async function POST(request: NextRequest) {
  const { text, targetLanguage } = await request.json();
  const supabase = await createClient();

  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç¢ºèª
  const { data: cached } = await supabase
    .from('translation_cache')
    .select('translated_text')
    .eq('source_text', text)
    .eq('source_language', 'ja')
    .eq('target_language', targetLanguage)
    .single();

  if (cached) {
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ
    await supabase
      .from('translation_cache')
      .update({
        last_accessed_at: new Date().toISOString(),
        access_count: supabase.rpc('increment', { x: 1 })
      })
      .eq('source_text', text)
      .eq('target_language', targetLanguage);

    return Response.json({ translatedText: cached.translated_text });
  }

  // æ–°è¦ç¿»è¨³
  let translatedText = await translateText(text, 'ja', targetLanguage);

  // ã‚«ãƒ¼ãƒ‰åã‚’è¾æ›¸ã§ç½®æ›
  translatedText = await replaceCardNames(translatedText, targetLanguage, supabase);

  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
  await supabase
    .from('translation_cache')
    .insert({
      source_text: text,
      source_language: 'ja',
      target_language: targetLanguage,
      translated_text: translatedText,
      service_used: 'google-translate',
      char_count: text.length
    });

  return Response.json({ translatedText });
}
```

#### 5-5. ã‚«ãƒ¼ãƒ‰åç½®æ›æ©Ÿèƒ½

```typescript
// lib/translation.ts

/**
 * ã‚«ãƒ¼ãƒ‰åè¾æ›¸ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
 */
let cardNameDictionary: Map<string, Record<string, string>> | null = null;
let dictionaryLoadedAt: number = 0;
const CACHE_TTL = 3600000; // 1æ™‚é–“

/**
 * ã‚«ãƒ¼ãƒ‰åè¾æ›¸ã‚’å–å¾—
 */
async function getCardNameDictionary(supabase: any): Promise<Map<string, Record<string, string>>> {
  const now = Date.now();

  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæœ‰åŠ¹ãªã‚‰ãã‚Œã‚’è¿”ã™
  if (cardNameDictionary && (now - dictionaryLoadedAt) < CACHE_TTL) {
    return cardNameDictionary;
  }

  // DBã‹ã‚‰å…¨ã‚«ãƒ¼ãƒ‰åã‚’å–å¾—
  const { data: cards } = await supabase
    .from('cards')
    .select('id, name, name_multilingual');

  const dictionary = new Map<string, Record<string, string>>();

  cards?.forEach((card: any) => {
    // æ—¥æœ¬èªåã‚’ã‚­ãƒ¼ã«ã€å„è¨€èªã®ç¿»è¨³ã‚’å€¤ã¨ã—ã¦ä¿å­˜
    const jaName = card.name_multilingual?.ja || card.name;
    dictionary.set(jaName, card.name_multilingual || { ja: jaName });
  });

  cardNameDictionary = dictionary;
  dictionaryLoadedAt = now;

  return dictionary;
}

/**
 * ã‚³ãƒ¡ãƒ³ãƒˆå†…ã®ã‚«ãƒ¼ãƒ‰åã‚’ç½®æ›
 */
export async function replaceCardNames(
  text: string,
  targetLanguage: string,
  supabase: any
): Promise<string> {
  const dictionary = await getCardNameDictionary(supabase);
  let result = text;

  // è¾æ›¸ã®å…¨ã‚«ãƒ¼ãƒ‰åã§ãƒãƒƒãƒãƒ³ã‚°
  dictionary.forEach((translations, jaName) => {
    const targetName = translations[targetLanguage] || jaName;

    // æ—¥æœ¬èªã‚«ãƒ¼ãƒ‰åãŒå«ã¾ã‚Œã¦ã„ã‚Œã°ã€å¯¾è±¡è¨€èªã®ã‚«ãƒ¼ãƒ‰åã«ç½®æ›
    // å®Œå…¨ä¸€è‡´ã®ã¿ï¼ˆéƒ¨åˆ†ä¸€è‡´ã‚’é¿ã‘ã‚‹ï¼‰
    const regex = new RegExp(`\\b${escapeRegExp(jaName)}\\b`, 'g');
    result = result.replace(regex, targetName);
  });

  return result;
}

/**
 * æ­£è¦è¡¨ç¾ç”¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
 */
function escapeRegExp(string: string): string {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

/**
 * ãƒ†ã‚­ã‚¹ãƒˆç¿»è¨³ï¼ˆGoogle Cloud Translateï¼‰
 */
export async function translateText(
  text: string,
  sourceLanguage: string,
  targetLanguage: string
): Promise<string> {
  const { TranslationServiceClient } = require('@google-cloud/translate').v2;
  const translate = new TranslationServiceClient();

  try {
    const [translation] = await translate.translate(text, {
      from: sourceLanguage,
      to: targetLanguage,
    });

    return translation;
  } catch (error) {
    console.error('Translation error:', error);
    throw error;
  }
}
```

#### 5-6. ã‚«ãƒ¼ãƒ‰åç½®æ›ã®å‹•ä½œä¾‹

```typescript
// å…¥åŠ›ï¼ˆæ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆï¼‰
const originalComment = "ãƒ”ã‚«ãƒãƒ¥ã‚¦exã¨ãƒŸãƒ¥ã‚¦ãƒ„ãƒ¼exã®ãƒ‡ãƒƒã‚­ãŒå¼·ã„ã§ã™";

// ç¿»è¨³å¾Œï¼ˆè‹±èªã€ã‚«ãƒ¼ãƒ‰åç½®æ›å‰ï¼‰
const translated = "The deck of Pikachu ex and Mewtwo ex is strong";

// ã‚«ãƒ¼ãƒ‰åç½®æ›å¾Œï¼ˆè‹±èªï¼‰
const withCardNames = "The deck of Pikachu ex and Mewtwo ex is strong";
// â†‘ ã“ã®ä¾‹ã§ã¯ãŸã¾ãŸã¾ä¸€è‡´ã—ã¦ã„ã‚‹ãŒã€é€šå¸¸ã¯ç¿»è¨³ãŒãšã‚Œã‚‹

// ã‚ˆã‚Šæ­£ç¢ºãªä¾‹:
// å…¥åŠ›: "ãƒªã‚¶ãƒ¼ãƒ‰ãƒ³exãŒæ¬²ã—ã„ã§ã™"
// ç¿»è¨³å‰: "I want a Lizard ex"  â† èª¤è¨³
// ç½®æ›å¾Œ: "I want a Charizard ex" â† æ­£ã—ã„ã‚«ãƒ¼ãƒ‰åã«ç½®æ›
```

#### 5-7. ã‚«ãƒ¼ãƒ‰åè¾æ›¸ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

**æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚ŒãŸã¨ã**:

```typescript
// cards ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ 
await supabase.from('cards').insert({
  name: 'ãƒ”ã‚«ãƒãƒ¥ã‚¦ex',
  name_multilingual: {
    ja: 'ãƒ”ã‚«ãƒãƒ¥ã‚¦ex',
    en: 'Pikachu ex',
    'zh-CN': 'çš®å¡ä¸˜ex',
    'zh-TW': 'çš®å¡ä¸˜ex',
    ko: 'í”¼ì¹´ì¸„ex'
  }
});

// ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯1æ™‚é–“ã§è‡ªå‹•æ›´æ–°
// ã¾ãŸã¯æ‰‹å‹•ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
cardNameDictionary = null;
```

### Phase 6: æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹ï¼ˆ1é€±é–“ï¼‰

- [ ] æœ¬ç•ªDBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- [ ] ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
- [ ] mainãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸
- [ ] æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] å‹•ä½œç¢ºèª

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **next-intl**: UIãƒ†ã‚­ã‚¹ãƒˆã®ç¿»è¨³
- **React**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **Supabase**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **PostgreSQL**: JSONBå‹ã§å¤šè¨€èªãƒ‡ãƒ¼ã‚¿ç®¡ç†

### ç¿»è¨³API
- **Google Cloud Translate API**: ãƒ¡ã‚¤ãƒ³ç¿»è¨³ã‚µãƒ¼ãƒ“ã‚¹
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç¿»è¨³
  - 100è¨€èªä»¥ä¸Šå¯¾å¿œ
  - æ–‡å­—æ•°èª²é‡‘ï¼ˆ$20/100ä¸‡æ–‡å­—ï¼‰
  - æ—¢å­˜ã®Google Cloudè¨­å®šã‚’æ´»ç”¨

---

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»

### ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®å®Ÿè¡Œæ‰‹é †

```bash
# 1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³SQLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cat > migrations/001_add_i18n_tables.sql << 'EOF'
-- ä¸Šè¨˜ã®ã€Œå®Œå…¨ãªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³SQLã€ã‚’ã‚³ãƒ”ãƒ¼
EOF

# 2. ãƒ†ã‚¹ãƒˆç’°å¢ƒã§å®Ÿè¡Œ
psql "postgresql://postgres:iZVIKuRfhhGmplxwjduVeUWLEiTisaui@db.oflucnwezzqqtxryonhf.supabase.co:5432/postgres" < migrations/001_add_i18n_tables.sql

# 3. ç¢ºèª
psql "postgresql://..." -c "
  SELECT table_name
  FROM information_schema.tables
  WHERE table_name LIKE '%i18n%';
"

# 4. ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
pnpm tsx scripts/migrate-i18n-data.ts
```

### æœ¬ç•ªç’°å¢ƒã§ã®å®Ÿè¡Œæ‰‹é †

```bash
# 1. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
pg_dump "æœ¬ç•ªã®POSTGRES_URL" -f backup_before_i18n_migration.sql

# 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
psql "æœ¬ç•ªã®POSTGRES_URL" < migrations/001_add_i18n_tables.sql

# 3. ç¢ºèª
psql "æœ¬ç•ªã®POSTGRES_URL" -c "\dt *i18n*"

# 4. ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
SUPABASE_URL=æœ¬ç•ªURL SUPABASE_SERVICE_ROLE_KEY=æœ¬ç•ªKEY pnpm tsx scripts/migrate-i18n-data.ts
```

---

## ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨€èªæ¤œå‡º

### å„ªå…ˆé †ä½

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š** (user_profiles.preferred_language)
2. **URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿** (/en/trades)
3. **Cookie** (NEXT_LOCALE)
4. **Accept-Language ãƒ˜ãƒƒãƒ€ãƒ¼**
5. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ** (ja)

### å®Ÿè£…

```typescript
// middleware.ts
import createMiddleware from 'next-intl/middleware';
import { NextRequest } from 'next/server';

export default async function middleware(request: NextRequest) {
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã‚’ç¢ºèª
  const userId = request.cookies.get('sb-access-token');

  if (userId) {
    // DBã‹ã‚‰ preferred_language ã‚’å–å¾—
    const userLang = await getUserPreferredLanguage(userId);
    if (userLang) {
      return createMiddleware({
        locales: ['ja', 'en', 'zh-cn'],
        defaultLocale: userLang
      })(request);
    }
  }

  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨€èªæ¤œå‡º
  return createMiddleware({
    locales: ['ja', 'en', 'zh-cn'],
    defaultLocale: 'ja'
  })(request);
}
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°

```typescript
// ã‚«ãƒ¼ãƒ‰ç¿»è¨³ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
import { cache } from 'react';

export const getCardWithTranslation = cache(async (cardId: number, locale: string) => {
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸå–å¾—
  return await fetchCard(cardId, locale);
});
```

### 2. ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰

```typescript
// ã‚ˆãä½¿ã†ç¿»è¨³ã‚’äº‹å‰ãƒ­ãƒ¼ãƒ‰
export async function generateStaticParams() {
  return [
    { locale: 'ja' },
    { locale: 'en' },
    { locale: 'zh-cn' }
  ];
}
```

### 3. éƒ¨åˆ†ç¿»è¨³

é‡è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿ç¿»è¨³ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜

```sql
-- ã‚«ãƒ¼ãƒ‰åã ã‘ç¿»è¨³ã€èª¬æ˜æ–‡ã¯å¾Œå›ã—
INSERT INTO cards_i18n (card_id, language, name)
SELECT id, 'en', translate_name(name)
FROM cards;
```

---

## ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 2: ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³SQLä½œæˆ
- [ ] ãƒ†ã‚¹ãƒˆç’°å¢ƒã§å®Ÿè¡Œ
- [ ] ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆç¢ºèª
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç¢ºèª
- [ ] æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ

### Phase 3: APIå®Ÿè£…
- [ ] ã‚«ãƒ¼ãƒ‰å–å¾—API
- [ ] è¨˜äº‹å–å¾—API
- [ ] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### Phase 4: ç¿»è¨³ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
- [ ] ã‚«ãƒ¼ãƒ‰åç¿»è¨³ï¼ˆè‹±èªï¼‰
- [ ] ãƒ‘ãƒƒã‚¯åç¿»è¨³ï¼ˆè‹±èªï¼‰
- [ ] ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç¿»è¨³ï¼ˆè‹±èªï¼‰
- [ ] ãã®ä»–è¨€èªç¿»è¨³

### Phase 5: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- [ ] ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] è¨˜äº‹è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] è¨€èªåˆ‡ã‚Šæ›¿ãˆ
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š

### Phase 6: ãƒªãƒªãƒ¼ã‚¹
- [ ] æœ¬ç•ªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] å‹•ä½œç¢ºèª

---

## ğŸ“Š Phase 2 å®Œäº†ã‚µãƒãƒªãƒ¼ï¼ˆ2025-11-25ï¼‰

### å®Ÿæ–½å†…å®¹

**1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´**
- 13ãƒ†ãƒ¼ãƒ–ãƒ«ã«48ã‚«ãƒ©ãƒ ã®å¤šè¨€èªå¯¾å¿œJSONBã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
- 26å€‹ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆï¼ˆ18 GIN + 8 BTREEï¼‰
- translation_cache, translation_jobs è£œåŠ©ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
- ãƒ†ã‚¹ãƒˆç’°å¢ƒ: `db.oflucnwezzqqtxryonhf.supabase.co`

**2. æ—¢å­˜ãƒ‡ãƒ¼ã‚¿å¤‰æ›**
- æ—¥æœ¬èªãƒ‡ãƒ¼ã‚¿ã‚’JSONBå½¢å¼ã«è‡ªå‹•å¤‰æ›
- æ›´æ–°ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°:
  - cards: 2,259ä»¶
  - packs: 18ä»¶
  - deck_pages: 8ä»¶
  - info_article_blocks: 9ä»¶
  - tournaments: 3ä»¶
  - decks: 2ä»¶
  - trade_posts: 149,862ä»¶
  - user_collages: 1ä»¶

**3. å¤šè¨€èªã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ**
- CSVã‹ã‚‰6è¨€èªã®ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆ2,248ä»¶ï¼‰
- å¯¾å¿œè¨€èª: è‹±èª(en), éŸ“å›½èª(ko), ä¸­å›½èªç¹ä½“å­—(zh-TW), ãƒ•ãƒ©ãƒ³ã‚¹èª(fr), ã‚¹ãƒšã‚¤ãƒ³èª(es), ãƒ‰ã‚¤ãƒ„èª(de)
- ã‚«ãƒãƒ¼ç‡: 99.5%ï¼ˆ2,246/2,257ä»¶ï¼‰

**4. ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ**
- `scripts/phase2-i18n-migration-fixed.sql` - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³SQL
- `scripts/phase2-i18n-rollback.sql` - ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯SQL
- `scripts/generate-cards-update-sql.js` - ã‚«ãƒ¼ãƒ‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°SQLç”Ÿæˆ
- `scripts/update-cards-metadata.sql` - ã‚«ãƒ¼ãƒ‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°SQLï¼ˆ2,259ä»¶ï¼‰
- `scripts/import-multilingual-cards.js` - å¤šè¨€èªã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `scripts/import-multilingual-cards.sql` - ç”Ÿæˆã•ã‚ŒãŸã‚¤ãƒ³ãƒãƒ¼ãƒˆSQLï¼ˆ2,248ä»¶ï¼‰
- `docs/phase2-migration-guide.md` - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã‚¬ã‚¤ãƒ‰
- `docs/cards-update-guide.md` - ã‚«ãƒ¼ãƒ‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¬ã‚¤ãƒ‰
- `docs/current-database-schema.md` - ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ä¾‹

**cards ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰**:
```json
{
  "id": 3101,
  "name": "ãƒ©ãƒ—ãƒ©ã‚¹ex",
  "col_3": "PROMO-A",
  "col_4": "014/P-A",
  "col_5": "P-A-014",
  "name_multilingual": {
    "ja": "ãƒ©ãƒ—ãƒ©ã‚¹ex",
    "en": "Lapras ex",
    "ko": "ë¼í”„ë¼ìŠ¤ ex",
    "zh-TW": "æ‹‰æ™®æ‹‰æ–¯ ex",
    "fr": "Lokhlass ex",
    "es": "Lapras ex",
    "de": "Lapras ex"
  },
  "image_url_multilingual": {
    "ja": "https://kidyrurtyvxqokhszgko.supabase.co/.../1.webp",
    "en": "https://assets.tcgdex.net/en/tcgp/P-A/014/low.webp",
    "ko": "https://ptcgp-tracker.com/.../ko_KR/14.webp",
    "zh-TW": "https://ptcgp-tracker.com/.../zh_TW/14.webp",
    "fr": "https://ptcgp-tracker.com/.../fr_FR/14.webp",
    "es": "https://ptcgp-tracker.com/.../es_ES/14.webp",
    "de": "https://ptcgp-tracker.com/.../de_DE/14.webp"
  }
}
```

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**Phase 3: APIå®Ÿè£…**
- JSONBæŠ½å‡ºãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®ä½œæˆ
- å„ç¨®å–å¾—APIã®å®Ÿè£…ï¼ˆã‚«ãƒ¼ãƒ‰ã€è¨˜äº‹ã€ãƒ‡ãƒƒã‚­ã€ãƒˆãƒ¬ãƒ¼ãƒ‰æŠ•ç¨¿ï¼‰
- è¨€èªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã®å®Ÿè£…

---

**ä½œæˆè€…**: Claude Code
**æœ€çµ‚æ›´æ–°**: 2025-11-25
